import{j as e,r as c,p as b}from"./index-DPXp0CxH.js";function _({topic:n,isOpen:d,onToggle:o,onCheck:l,checked:u,isAnswered:h}){const m=e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6 stroke-green-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})});return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{onClick:o,className:"bg-gray-100 p-4 cursor-pointer flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-lg",children:n.short_title}),e.jsx("p",{children:h(n)?m:""})]}),d&&e.jsx("div",{className:"p-4 bg-white",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:n.title}),e.jsx("p",{className:"text-gray-600 italic",children:n.short_title})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Stances:"}),(n.stances||[]).map((a,x)=>{var i;return e.jsx("label",{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"radio",name:n.short_title,value:a.value,checked:((i=u[n.id])==null?void 0:i.answer)==a.value,onChange:()=>l(n,a.value)}),e.jsxs("p",{className:"mb-1",children:[a.value,". ",a.text]},x)]})},a.value)})]})]})})]})}function I({topics:n}){const[d,o]=c.useState(null),[l,u]=c.useState({}),[h,m]=c.useState([]),[a,x]=c.useState({}),[i,p]=c.useState(!1),[f,j]=c.useState(""),[v,g]=c.useState(b);c.useEffect(()=>{if(d){const s=setTimeout(()=>o(null),1e4);return()=>clearTimeout(s)}},[d]);const N=s=>{j(s.target.value)},y=n.filter(s=>s.short_title.toLowerCase().includes(f.toLowerCase())),w=(s,r)=>{if(u(t=>({...t,[s]:r})),s=="pic_url"){const t=new Image;t.src=r,t.onload=()=>{g(r)},t.onerror=()=>{g(b)}}},k=s=>{m(r=>r.includes(s)?r.filter(t=>t!==s):[...r,s])},C=()=>{p(!i)},S=(s,r)=>{x(t=>({...t,[s.id]:{answer:r}}))},O=s=>s.id in a,T=()=>Object.entries(a).map(([s,r])=>({topic_id:s,value:r.answer})),U=async()=>{try{const s=await fetch("https://ev-backend-edhm.onrender.com/auth/create-dummy",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.username,profile_pic_url:l.pic_url})});if(!s.ok){const t=await s.text();console.error("Failed to create dummy user:",t),o("error");return}const r=await fetch("https://ev-backend-edhm.onrender.com/compass/answers/dummy",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l.username,answers:T()})});if(!r.ok){const t=await r.text();console.error("Failed to add dummy answers:",t),o("error");return}console.log("Dummy user and answers created successfully!"),o("success"),u({}),x({}),m([]),p(!1),j("")}catch(s){console.error("Unexpected error:",s),o("error")}};return e.jsx("div",{className:"w-full md:w-3/4 mx-auto mt-6 space-y-4",children:e.jsxs("div",{className:"mx-6 mt-6 border p-4 rounded-xl",children:[e.jsx("h1",{className:"text-2xl font-semibold text-center",children:"Create a dummy user"}),d==="success"&&e.jsx("div",{className:"text-green-700 text-center font-medium mt-2",children:"✅ Dummy user created successfully!"}),d==="error"&&e.jsx("div",{className:"text-red-600 text-center font-medium mt-2",children:"❌ Failed to create dummy user. Please try again."}),e.jsxs("div",{className:"flex flex-col items-center gap-2 justify-center mt-6",children:[e.jsx("img",{src:v,alt:`${l.username}'s profile`,className:"w-24 h-24 object-cover rounded-full border shadow"}),e.jsx("div",{className:"flex flex-col gap-2 mt-2 w-1/3",children:e.jsx("input",{type:"text",className:"border p-1 rounded",placeholder:"Enter image URL...",value:l.pic_url,onChange:s=>{w("pic_url",s.target.value)}})})]}),e.jsxs("div",{className:"w-full md:w-3/4 m-auto mt-6 flex flex-col gap-2 items-center rounded-xl",children:[e.jsx("h1",{className:"block text-xl font-semibold",children:"Username"}),e.jsx("input",{className:"border rounded p-1 w-1/2 bg-white",value:l.username,onChange:s=>w("username",s.target.value)})]}),e.jsxs("div",{className:"w-full md:w-3/4 m-auto mt-6 flex flex-col gap-4 bg-neutral-50 border border-neutral-200 p-4 rounded-xl cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h1",{className:"block text-xl font-semibold",children:"Add Answers:"}),e.jsx("button",{className:"cursor-pointer underline",onClick:C,children:i?"Close":"Open"})]}),e.jsxs("div",{className:`${i?"block":"hidden"} flex flex-col gap-4`,children:[e.jsx("input",{id:"search",className:"border rounded p-2 w-full bg-white",value:f,placeholder:"Search...",onChange:s=>N(s)}),y.map(s=>e.jsx(_,{topic:s,isOpen:h.includes(s.id),onToggle:()=>k(s.id),onCheck:S,checked:a,isAnswered:O},s.id))]})]}),e.jsx("div",{className:"flex justify-center gap-2 mt-6",children:e.jsx("button",{disabled:!l.username,onClick:U,className:"px-4 py-2 bg-black text-white rounded disabled:opacity-50 cursor-pointer disabled:cursor-not-allowed",children:"Create"})})]})})}export{I as default};
